# Details about configuring MPV for high quality video is covered here: https://freetime.mikeconnelly.com/archives/5371
# The latest version of this file is here: https://github.com/classicjazz/mpv-config

# For more options, see: https://github.com/mpv-player/mpv/blob/master/etc/mpv.conf
# gpu-hq presets are here: https://github.com/mpv-player/mpv/blob/master/etc/builtin.conf


###########
# General #
###########

profile=gpu-hq # high quality video rendering preset 

gpu-api=opengl
opengl-pbo=yes
vd-lavc-dr=yes

# gpu-api=vulkan
# vulkan-async-compute=yes
# vulkan-async-transfer=yes
# vulkan-queue-count=1

hwdec=auto # turn off for better quality with software decoding


########
# Misc #
########

border=no # hide the window title bar
no-hidpi-window-scale # used on 5K iMac to prevent OSX scaling


##############
# Resolution #
##############

geometry=3840x2160 # force 4k resolution output
# fullscreen = yes # start in fullscreen mode by default


##############
# Colorspace #
##############

icc-contrast=1000
# icc-profile-auto=yes # enable for OLED displays
# target-prim=bt.2020 # target Rec.2020 (wide color gamut) for HDR TVs


##########
# Dither #
##########

dither-depth=auto
temporal-dither=yes


#############
# Debanding #
#############

deband=yes
deband-iterations=2 # deband steps
deband-threshold=20 # deband strength
deband-range=12 # deband range
deband-grain=0 # dynamic grain: set to "0" if using the static grain shader


########################
# Motion Interpolation #
########################

blend-subtitles=yes
video-sync=display-resample # required because interpolation is enabled
interpolation=yes 
tscale=box
tscale-window=sphinx
tscale-radius=1.01
tscale-clamp=0.0
temporal-dither


################
# Anti-Ringing #
################

scale-antiring=0.7 # luma upscale deringing
dscale-antiring=0.7 # luma downscale deringing
cscale-antiring=0.7 # chroma upscale deringing


#############################################################
# Upscaling & Processing Based on Source Video's Resolution #
#############################################################

# Chroma subsampling means that chroma information is encoded at lower resolution than luma
# In MPV, chroma is upscaled to luma resolution (video size) and then the converted RGB is upscaled to target resolution (screen size)

# fbo-format=rgba16hf # use with gpu-api=vulkan
fbo-format=rgba16f # use with gpu-api=opengl
glsl-shaders="~/.config/mpv/shaders/noise_static_luma.hook"
glsl-shaders-append="~/.config/mpv/shaders/noise_static_chroma.hook"
# luma upscaling
glsl-shaders-append="~/.config/mpv/shaders/FSRCNNX_x2_8-0-4-1.glsl"
scale=ewa_lanczossharp
# luma downscaling
glsl-shaders-append="~/.config/mpv/Shaders/SSimDownscaler.glsl"
dscale=mitchell
linear-downscaling=no
# chroma upscaling and downscaling
# glsl-shaders-append="~/.config/mpv/Shaders/KrigBilateral.glsl" # enabling this may result in dropped frames on Macs
cscale=mitchell


############
# Profiles #
############

# 7680x4320 (UHDTV)
# 3840x2160 (UHDTV)
# No upscaling required
[4k60] # 4K @ 60 fps
profile-desc=cond:((get("video-params/w", -math.huge)>1920 or get("video-params/h", -math.huge)>1080) and ((get("container-fps", -math.huge)>=31 and get("estimated-vf-fps", -math.huge)>=31) or get("container-fps", -math.huge)>=31))
glsl-shaders-clr
deband=no
deinterlace=no

[4k30] # 4K @ 30 fps
profile-desc=cond:((get("video-params/w", -math.huge)>1920 or get("video-params/h", -math.huge)>1080) and get("container-fps", -math.huge)<31 and get("estimated-vf-fps", -math.huge)<31)
glsl-shaders-clr
deband=no
deinterlace=no

[full-hd] # 1920x1080 (HDTV, Blu-ray)
profile-desc=cond:((get("video-params/w", -math.huge)<=1920 and get("video-params/h", -math.huge)<=1080) and (get("video-params/w", -math.huge)>= 1358 or get("video-params/h", -math.huge)>=764))
deinterlace=no

[hd]
# 1280x720 (HDTV, Blu-ray)
profile-desc=cond:((get("video-params/w", -math.huge)<1358 and get("video-params/h", -math.huge)<764) and (get("video-params/w", -math.huge)>=1080 or get("video-params/h", -math.huge)>=608) and get("container-fps", -math.huge)<31 and get("estimated-vf-fps", -math.huge)<31)

[sdtv-ntsc]
# 640x480 (NTSC Broadcast)
# 704x480 (NTSC Broadcast)
# 720x480 (NTSC DVD)
profile-desc=cond:((get("video-params/w", -math.huge)<1080 and get("video-params/h", -math.huge)<608) and (get("video-params/w", -math.huge)>678 or get("video-params/h", -math.huge)>381))

[sdtv-pal]
# 352x576 (PAL Broadcast)
# 480x576 (PAL Broadcast)
# 544x576 (PAL Broadcast)
# 720x576 (PAL Broadcast or DVD)
profile-desc=cond:get('height', -math.huge) == 576
deinterlace=yes


[protocol.http]
force-window=immediate

[protocol.https]
profile=protocol.http

[protocol.ytdl]
profile=protocol.http
